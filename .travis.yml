language:                   python

python:                     3.6.7

cache:                      pip

jobs:
  include:
    - stage:                Testing

      install:
          - pip install -r requirements.txt

      script:
          - python Source/test.py

    - stage:                Deployment

      if:                   type != pull_request AND tag IS present

      install:
          - pip install pyminifier pbr

      before_script:
          - cd Source

      script:
          - find echo_lang -type f -name "*.py" -exec pyminifier --lzma --obfuscate-variables --outfile="{}" "{}" \;

      deploy:
          - provider:       pypi
            user:           "eevee1"
            password:       $pypi_password
            skip_cleanup:   true
            server:         https://test.pypi.org/legacy/
            distributions:  "sdist bdist_wheel"
            on:
                tags: true

          - provider:       pypi
            user:           "eevee1"
            password:       "$pypi_password"
            skip_cleanup:   true
            distributions:  "sdist bdist_wheel"
            on:
                tags: true

env:
    global:
        secure: "T7pIBRlw0La2tE6Fi1nNWQLCDPfWGd6GsPSireV0e4s5TzyurVnMzbduBJV+ROgR/puQXH3pVLhYnEQc4M2QQzBLdWVz5VVZuaVHz3i/+MQKkKWst4SuPeBYJlTxPxZpnd1Op2EomUF6IBS2LCezsLi/i+ghsDqqmlxUYEqG/c8axWb9HimHnHwbgFx8pK1qSe/eyIwrWYoD01JXAlOlTY5D7yvE09Qo2Fu5S04ysRzpQKYgwm6ZzScfuFHvCCpwMjsguWJLsvfaZm6LUustYg80Q6Tb334UG9Yb+Od4WqJPG7a0ywBzHicHVPT427rhGr3sbiIQJn3MOjNNRasyh+GZErRMzIQlbKYDxNoRSyvnbq+MVa3ij8eUEfJ1Vw+EMnwK7zQ3zIS4WOdelsUxWs15T4M146bUl9MG+w++m6RfJz1Fp4YgJPEmfbWXslGQD/Bk52BJQxl4ZOINQc7sm80qrGvAKz+8LHzJQMkOwVw7j4V6TtQlVOtXNxQghieunUoTyvAKiK6Cb2QfVymCaGENCNM70U8v29SdZR94GHJ9+klrC2trwQjwyViZqIf+uXYkiqp4zalXbVFYHgsbf5dkwyPhnCtvco+6qJB9WcKYwwU8WhotfMhgSGzv5mn7KHvvF/J/LmCG69ON3WfGimZuT6Clw26siQj4CAOZrRI="
