language:                   python

python:                     3.6.7

cache:                      pip

jobs:
  include:
    - stage:                Testing

      install:
          - pip install -r requirements.txt

      script:
          - python Source/test.py

    - stage:                Deployment

      if:                   type != pull_request AND tag IS present

      install:
          - pip install pyminifier pbr

      before_script:
          - cd Source

      script:
          - find echo_lang -type f -name "*.py" -exec pyminifier --lzma --obfuscate-variables --outfile="{}" "{}" \;

      deploy:
          - provider:       pypi
            user:           "eevee1"
            password:       "$pypi_password"
            skip_cleanup:   true
            server:         https://test.pypi.org/legacy/
            distributions:  "sdist bdist_wheel"
            on:
                tags: true

          - provider:       pypi
            user:           "eevee1"
            password:       "$pypi_password"
            skip_cleanup:   true
            distributions:  "sdist bdist_wheel"
            on:
                tags: true

env:
    global:
        - secure: W+ZL6Tpx/q5fxc3R8Z9KXEPiZQViVXI2nyqhhki2+heX9+K6FvXablLXKMEBUOJ2wbhDA/2wkOpYXdTrLxo4ugjnB2bx9ePZaZSCEtCVqXj1fMBvSbDLcIVNNE3a6cgDNXoc+odvoAnF0/QgiZbDGmeUufE5FKAa6GgLEKlif7Qv/glTV4nfzc3f5ahyu5T9KACXq8LZ5cqbVL9cLJFezanI91HMWsn/6ANd7CH83H5AKixHN4A5TWvCkOvYS5x6gvOgvPHtqtFzGC0JRwCsNnWPshpNjjeu1Gf5k2/QAj5V9bqmaSBvL9AY6ip4DGcZHTdP7rDRFM5rBiIOh3ZABDZwZXA9Tty2aE8xf163+RraOer6s/S9GEkhRNHbzkGjQ0w7zxJM/gYDXgvgBPm0/nknPC7+a1om/5JQL1lOcg8aqGkHJvQVK3vD6nlXsnlhhgYc/c2jRtY6D8/rXcXKkGhuYg/esUzy6ZOa5mjaVm69X8TzOtNHlVUx5ccyYjNBCFJ1q6Tm5PZsggPZV0ZnJ8idn2rfsAjVf05SDq+75TcZ9s5LUl4CsjAvrAMG2e3wTioIPlb0UU5djkieGT3lrVy2CHfGDtSl4+UUHadAm9uhsQK0TXpkHZ8PL54ehJrboVVevTgxo/ND2V3czuEj/uqbXFOnxsAGXfJ+BnbjSWs=
