language:                   python

python:                     3.6.7

cache:                      pip

jobs:
  include:
    - stage:                Testing

      install:
          - pip install -r requirements.txt

      script:
          - python Source/test.py

    - stage:                Deployment

      if:                   type != pull_request AND tag IS present

      install:
          - pip install pyminifier pbr

      before_script:
          - cd Source

      script:
          - find echo_lang -type f -name "*.py" -exec pyminifier --lzma --obfuscate-variables --outfile="{}" "{}" \;

      deploy:
          - provider:       pypi
            user:           "eevee1"
            password:       $pypi_password
            skip_cleanup:   true
            server:         https://test.pypi.org/legacy/
            distributions:  "sdist bdist_wheel"
            on:
                tags: true

          - provider:       pypi
            user:           "eevee1"
            password:       "$pypi_password"
            skip_cleanup:   true
            distributions:  "sdist bdist_wheel"
            on:
                tags: true

env:
    global:
        - secure:           "yrINZDM5bTrJSte5hfXyGWl44cJvIL/3zrdMGpmcFlvk2tUMeXK4tPeuZtVdWUKA5AB3KltSpe+iwKD2JTFBSFNFGv86yXBCjBXxljxGA/Nk8gSd7+MbfoXJgmwzeRj3ITeJkuF6cc2Acf5QrKuUpqRbvcrONZuHMca1hKSkMIgG4xzrwwHmEQiHniedAkLWIxLcEv5RYFBnff/2YFw9h/Ih820dQL9lpGEDdjMWrtyfJeXQVlG+ift8vwvN/JcxNx/d78YxLFXRU/ohaAPH9xaJyJ5R6sFwHEmwGHWnqpHqbkJ60+FsQ+Gc7HTbGDvb0SdcPG45/9xfELlTCNQ8f6MzZr4hOVIZockYAnaR71X0kHp8lYPYmpzb0i8VSB9Ue0+02g+HL7Jnw46qzVsnmWJN0QFd0T88nyb98cbbPXymgXTra7bTKFlSLH544p7wuaw7pjA9hIZYCNY1m5HKsFOAjMhVfExeh4BeACtzreFyOQjQbGKeEPAS8WKvLS2T+tYTfb3ojBH4BGXwYY0vfMBEse3ypWn/ZPSDkxRC0h4CiL4JKzV7NfQPjcFdffX56fo16yofTFAuWMa3sMyPTt9PmfjK1kMlnjlBCa++es7pbeGX+hrRffGlbzN4xMCFU4K38NgQVpZEtV5oEhDbq5CvHrdHV9HoF9WEayfNG2M="
