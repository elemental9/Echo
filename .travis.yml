language:                   python

python:                     3.6.7

cache:                      pip

jobs:
  include:
    - stage:                Testing

      install:
          - pip install -r requirements.txt

      script:
          - python Source/test.py

    - stage:                Deployment

      if:                   type != pull_request AND tag IS present

      install:
          - pip install pyminifier pbr

      before_script:
          - cd Source

      script:
          - find echo_lang -type f -name "*.py" -exec pyminifier --lzma --obfuscate-variables --outfile="{}" "{}" \;

      deploy:
          - provider:       pypi
            user:           "eevee1"
            password:       "$pypi_password"
            skip_cleanup:   true
            server:         https://test.pypi.org/legacy/
            distributions:  "sdist bdist_wheel"
            on:
                tags: true

          - provider:       pypi
            user:           "eevee1"
            password:       "$pypi_password"
            skip_cleanup:   true
            distributions:  "sdist bdist_wheel"
            on:
                tags: true

env:
    global:
        - secure: xGvHJGMiAfrrkj6tyVMNYHZ1TTLE5PhDzjXKU9egIep5IPPdy8iHbrhEH6m61+nCW8LSxra3iVTRIMIvCuVoLlrykaKrylMwKLmfFTzUs+JgeMjEUixLrkbRNVJeRnJshGz11myViVq1NCc5W3F3IBpbhH7K+yxfnYUuDInyyxxf90g53lEm4ujM6k8pnn/5/9XRc9u9YTkNHMps8EIWkQXWTO7DGQK4M5OrfcTgvqfu8IUFA8yxNdrWAuEC4TRBUYSO1fWaPTe+WXJXwnqWbaTvpFfa0PbSRND4q3adid1XvYMtDsD0VqcChvhmWDc+fLAeufCHYcOlSBwwLy+4XD9Pkh7r+JDkOZY7GHxlIGHZSu36KqF/DxFMGS1okMA0XoRyUUJFqyMZXDLN3eBYBLu9ZV/eBpbU/6PGJHK6MJuVQk74b4Smlnyu957RZqX4TwYiRMLNyQwTRrr8ZBRwtUmK5ep7ziJ6JKuhsjXmepzIU1livbQ1akF2UUal4HFeAr8CVFf8tEN2fEAqAIHZHIz3nqPzOJkp2NjVJNPfl95G0OqePd5dYgAnJ8EOu/+/oRAQWV/OwmW5N+sf80Jmw1eI0XgSju7S8HXsyzryBJvzbcDTjx7RGR/Dp5B9xhvIPf9xtN614rKv/pypi_token
